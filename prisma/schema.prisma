generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// ------------------ 1. المستخدمين ------------------
enum Role {
  ADMIN
  MODERATOR
  USER
}

model User {
  id        String   @id @default(uuid())
  username  String   @unique
  password  String
  role      Role     @default(USER)
  createdAt DateTime @default(now())

  players   Player[]  // العلاقة باللاعبين
}

// ------------------ 2. الغرف ------------------
enum RoomType {
  ARTICLE
  QUIZ
}

model Room {
  id        String   @id @default(uuid())
  name      String   @unique
  type      RoomType
  createdAt DateTime @default(now())

  roomScores PlayerRoomScore[]
}

// ------------------ 3. اللاعب ------------------
model Player {
  id        String   @id @default(uuid())
  username  String
  createdAt DateTime @default(now())

  userId String
  user   User @relation(fields: [userId], references: [id])

  roomScores PlayerRoomScore[]

  @@unique([username, userId]) // اللاعب لا يتكرر عند نفس المشرف
}

// ------------------ 4. سجل النقاط لكل غرفة ------------------
model PlayerRoomScore {
  playerId String
  roomId   String
  totalScore Int @default(0)
  updatedAt DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id])
  room   Room   @relation(fields: [roomId], references: [id])

  @@id([playerId, roomId])
  @@index([roomId, totalScore])
}
