generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// ----------------------------------------------------
// 1. Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠÙŠÙ† ÙˆØ§Ù„Ù…Ø´Ø±ÙÙŠÙ†
// ----------------------------------------------------
enum Role {
  ADMIN
  MODERATOR
  USER
}

model User {
  id        String   @id @default(uuid())
  username  String   @unique
  password  String
  role      Role     @default(USER)
  createdAt DateTime @default(now())
}

// ----------------------------------------------------
// 2. Ø§Ù„ØºØ±Ù ÙˆØ£Ù†ÙˆØ§Ø¹Ù‡Ø§
// ----------------------------------------------------
enum RoomType {
  ARTICLE
  QUIZ
}

model Room {
  id        String   @id @default(uuid())
  name      String   @unique
  type      RoomType
  createdAt DateTime @default(now())
  
  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø©: ÙƒÙ„ ØºØ±ÙØ© Ù„Ø¯ÙŠÙ‡Ø§ Ø³Ø¬Ù„Ø§Øª Ù†Ù‚Ø§Ø· Ù…ØªØ¹Ø¯Ø¯Ø©
  roomScores PlayerRoomScore[]
}

// ----------------------------------------------------
// 3. Ø§Ù„Ù„Ø§Ø¹Ø¨ (Ø§Ù„ÙƒÙŠØ§Ù† Ø§Ù„Ø°ÙŠ ÙŠØ¬Ù…Ø¹ Ø§Ù„Ù†Ù‚Ø§Ø·)
// ----------------------------------------------------
model Player {
  id        String   @id @default(uuid())
  username  String   @unique
  createdAt DateTime @default(now())

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø©: ÙƒÙ„ Ù„Ø§Ø¹Ø¨ Ù„Ø¯ÙŠÙ‡ Ø³Ø¬Ù„ Ù†Ù‚Ø§Ø· Ù„ÙƒÙ„ ØºØ±ÙØ©
  roomScores PlayerRoomScore[]
}

// ----------------------------------------------------
// 4. Ù†Ù…ÙˆØ°Ø¬ Ø³Ø¬Ù„ Ø§Ù„Ù†Ù‚Ø§Ø· Ù„ÙƒÙ„ ØºØ±ÙØ© (Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ¬Ù…ÙŠØ¹ÙŠ)
// ----------------------------------------------------
model PlayerRoomScore {
  // Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©: ØªØ¶Ù…Ù† Ø³Ø¬Ù„Ø§Ù‹ ÙˆØ§Ø­Ø¯Ø§Ù‹ Ù„ÙƒÙ„ Ù„Ø§Ø¹Ø¨ ÙÙŠ ÙƒÙ„ ØºØ±ÙØ©
  playerId String
  roomId   String

  // Ø­Ù‚Ù„ Ø§Ù„Ù†Ù‚Ø§Ø·: ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ Ø¨Ø´ÙƒÙ„ Ø¯ÙˆØ±ÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… upsert
  totalScore Int @default(0)

  updatedAt DateTime @updatedAt // Ø®ØªÙ… Ø²Ù…Ù†ÙŠ Ù„Ù„ØªØ­Ø¯ÙŠØ«

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª:
  player Player @relation(fields: [playerId], references: [id])
  room   Room   @relation(fields: [roomId], references: [id])

  // ğŸ”‘ Ø§Ù„ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ÙØªØ§Ø­ÙŠ: Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù…Ø±ÙƒØ¨
  @@id([playerId, roomId])
  // ÙÙ‡Ø±Ø³Ø© Ø¥Ø¶Ø§ÙÙŠØ© Ù„ØªØ³Ø±ÙŠØ¹ Ù„ÙˆØ­Ø© Ø§Ù„ØµØ¯Ø§Ø±Ø© (Leaderboard) Ù„ÙƒÙ„ ØºØ±ÙØ©
  @@index([roomId, totalScore])
}