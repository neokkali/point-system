generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// ------------------ 1. Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ------------------
enum Role {
  ADMIN
  MODERATOR
  USER
}



model User {
  id        String   @id @default(uuid())
  username  String   @unique
  password  String
  role      Role     @default(USER)
  createdAt DateTime @default(now())

  globalScore GlobalScore?

  players   Player[]
}

model GlobalScore {
  id        String   @id @default(uuid())
  userId    String   @unique
  totalScore Int     @default(0)
  wpm       Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User     @relation(fields: [userId], references: [id])
}



// ------------------ 2. Ø§Ù„ØºØ±Ù ------------------
enum RoomType {
  ARTICLE
  QUIZ
}

model Room {
  id        String   @id @default(uuid())
  name      String   @unique
  type      RoomType
  createdAt DateTime @default(now())

  roomScores PlayerRoomScore[]
}

// ------------------ 3. Ø§Ù„Ù„Ø§Ø¹Ø¨ ------------------
model Player {
  id        String   @id @default(uuid())
  username  String
  createdAt DateTime @default(now())

  userId String
  user   User @relation(fields: [userId], references: [id])

  roomScores PlayerRoomScore[]

  // ØªÙ…Øª Ø¥Ø²Ø§Ù„Ø© unique Ù‡Ù†Ø§
}

// ------------------ 4. Ø³Ø¬Ù„ Ø§Ù„Ù†Ù‚Ø§Ø· Ù„ÙƒÙ„ ØºØ±ÙØ© ------------------
model PlayerRoomScore {
  id          String   @id @default(uuid())
  playerId    String
  roomId      String
  totalScore  Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id])
  room   Room   @relation(fields: [roomId], references: [id])

  // ğŸ“Œ Ù‡Ø°Ø§ Ø§Ù„Ø´Ø±Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙŠØ¶Ù…Ù† Ù…Ø§ ÙŠÙ„ÙŠ:
  // Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù„Ù†ÙØ³ Ø§Ù„Ù…Ø´Ø±Ù Ø£Ù† ÙŠØ¶ÙŠÙ Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù… ÙÙŠ Ù†ÙØ³ Ø§Ù„ØºØ±ÙØ©
  @@unique([playerId, roomId])
}
